"use strict";

const Ajv = require("ajv").default;
const ajv = new Ajv({allErrors: true, strict: false});
require("ajv-errors")(ajv);
const { constants, debuglog } = require("./constants");
const schema = require("./validation_schema.json");

exports.checkParams = function(params) {
  if (!params) return "E0001000";
  schema.required = Object.keys(params)
  const validate = ajv.compile(schema)
  const valid = validate(params)
  let res;
  if (!valid) res = validate.errors.map((item) => item.message);
  return res;
}

exports.checkCmStatus = function(beforeStatus, afterStatus) {
  if (!beforeStatus in cmStatusMessage) return "E0002000";
  if (!afterStatus in cmStatusMessage[beforeStatus]) return "E0002000";
  return cmStatusMessage[beforeStatus][afterStatus];
}

const cmStatusMessage = Object.freeze({
  [constants.cmStatus.DELETE]: {
    [constants.cmStatus.DELETE]: "E0002000",
    [constants.cmStatus.CREATING]: "",
    [constants.cmStatus.COMPLETE]: "E0002000",
    [constants.cmStatus.CONVERT]: "E0002000",
    [constants.cmStatus.SHARING]: "E0002000",
    [constants.cmStatus.EXTERNAL_UPLOADING]: "E0002000",
    [constants.cmStatus.EXTERNAL_COMPLETE]: "E0002000",
  },
  [constants.cmStatus.CREATING]: {
    [constants.cmStatus.DELETE]: "E0002000",
    [constants.cmStatus.CREATING]: "E0002000",
    [constants.cmStatus.COMPLETE]: "E0002000",
    [constants.cmStatus.CONVERT]: "",
    [constants.cmStatus.SHARING]: "E0002000",
    [constants.cmStatus.EXTERNAL_UPLOADING]: "E0002000",
    [constants.cmStatus.EXTERNAL_COMPLETE]: "E0002000",
  },
  [constants.cmStatus.COMPLETE]: {
    [constants.cmStatus.DELETE]: "",
    [constants.cmStatus.CREATING]: "",
    [constants.cmStatus.COMPLETE]: "",
    [constants.cmStatus.CONVERT]: "E0002000",
    [constants.cmStatus.SHARING]: "",
    [constants.cmStatus.EXTERNAL_UPLOADING]: "",
    [constants.cmStatus.EXTERNAL_COMPLETE]: "E0002000",
  },
  [constants.cmStatus.CONVERT]: {
    [constants.cmStatus.DELETE]: "E0002000",
    [constants.cmStatus.CREATING]: "E0002000",
    [constants.cmStatus.COMPLETE]: "",
    [constants.cmStatus.CONVERT]: "E0002000",
    [constants.cmStatus.SHARING]: "E0002000",
    [constants.cmStatus.EXTERNAL_UPLOADING]: "E0002000",
    [constants.cmStatus.EXTERNAL_COMPLETE]: "E0002000",
  },
  [constants.cmStatus.SHARING]: {
    [constants.cmStatus.DELETE]: "E0002000",
    [constants.cmStatus.CREATING]: "E0002000",
    [constants.cmStatus.COMPLETE]: "",
    [constants.cmStatus.CONVERT]: "E0002000",
    [constants.cmStatus.SHARING]: "E0002000",
    [constants.cmStatus.EXTERNAL_UPLOADING]: "E0002000",
    [constants.cmStatus.EXTERNAL_COMPLETE]: "E0002000",
  },
  [constants.cmStatus.ERROR]: {
    [constants.cmStatus.DELETE]: "E0002000",
    [constants.cmStatus.CREATING]: "E0002000",
    [constants.cmStatus.COMPLETE]: "E0002000",
    [constants.cmStatus.CONVERT]: "E0002000",
    [constants.cmStatus.SHARING]: "E0002000",
    [constants.cmStatus.EXTERNAL_UPLOADING]: "E0002000",
    [constants.cmStatus.EXTERNAL_COMPLETE]: "E0002000",
  },
  [constants.cmStatus.EXTERNAL_UPLOADING]: {
    [constants.cmStatus.DELETE]: "E0002000",
    [constants.cmStatus.CREATING]: "E0002000",
    [constants.cmStatus.COMPLETE]: "E0002000",
    [constants.cmStatus.CONVERT]: "E0002000",
    [constants.cmStatus.SHARING]: "E0002000",
    [constants.cmStatus.EXTERNAL_UPLOADING]: "E0002000",
    [constants.cmStatus.EXTERNAL_COMPLETE]: "",
  },
  [constants.cmStatus.EXTERNAL_COMPLETE]: {
    [constants.cmStatus.DELETE]: "",
    [constants.cmStatus.CREATING]: "E0002000",
    [constants.cmStatus.COMPLETE]: "",
    [constants.cmStatus.CONVERT]: "E0002000",
    [constants.cmStatus.SHARING]: "E0002000",
    [constants.cmStatus.EXTERNAL_UPLOADING]: "",
    [constants.cmStatus.EXTERNAL_COMPLETE]: "E0002000",
  },
  [constants.cmStatus.EXTERNAL_ERROR]: {
    [constants.cmStatus.DELETE]: "E0002000",
    [constants.cmStatus.CREATING]: "E0002000",
    [constants.cmStatus.COMPLETE]: "",
    [constants.cmStatus.CONVERT]: "E0002000",
    [constants.cmStatus.SHARING]: "E0002000",
    [constants.cmStatus.EXTERNAL_UPLOADING]: "",
    [constants.cmStatus.EXTERNAL_COMPLETE]: "E0002000",
  },
});
