"use strict";

const fs = require("fs");
const path = require("path");

var UMesseConverter = function (s3Manager) {
  this.s3Manager = s3Manager;
  this.ffmpeg = `ffmpeg -hide_banner`;
  this.basePath = "/tmp/umesse";
  return require("umesse-lib/converter/fluent-ffmpeg-processor")(
    UMesseConverter.prototype
  );
};

UMesseConverter.prototype.getWorkDir = function (unisCustomerCd, cmId) {
  return path.join(this.basePath, unisCustomerCd, "mix", cmId);
};

UMesseConverter.prototype.getContents = async function (
  bucket,
  target,
  outputPath,
  outputFileName
) {
  try {
    const res = await this.s3Manager.get(bucket, target);
    if (!res || !res.Body) throw "getObject failed";
    fs.writeFileSync(`${outputPath}/${outputFileName}`, res.Body);
    return true;
  } catch (e) {
    console.error(e);
    return false;
  }
};

module.exports = UMesseConverter;
